# Default configuration for containerized tidb-graphql
#
# This file is baked into the container image at /etc/tidb-graphql/tidb-graphql.yaml.
# It provides PRODUCTION-oriented defaults for container deployments.
#
# For local development with docker-compose, several values are overridden by
# TIGQL_* environment variables in docker-compose.yml (e.g., GraphiQL is
# enabled, server TLS is disabled, and logging uses human-readable text format).
#
# Override individual values with TIGQL_* environment variables, or replace the
# entire file by mounting your own config:
#
#   Docker:  -v ./my-config.yaml:/etc/tidb-graphql/tidb-graphql.yaml
#   K8s:     ConfigMap mounted at /etc/tidb-graphql/
#
# See docs/reference/configuration.md for the full reference.

database:
  # Connection: Set TIGQL_DATABASE_DSN or TIGQL_DATABASE_DSN_FILE for connection string,
  # or use discrete fields below. DSN takes precedence if both are set.
  # dsn_file: /run/secrets/database_dsn  # Read DSN from mounted secret

  host: tidb              # Service name â€” resolves via Docker Compose / K8s DNS
  port: 4000
  user: root
  database: test

  # TLS configuration (for TiDB Cloud or secure connections)
  tls:
    mode: skip-verify # off, skip-verify, verify-ca, verify-full
    # ca_file: /etc/ssl/tidb/ca-cert.pem
    # cert_file: /etc/ssl/tidb/client-cert.pem
    # key_file: /etc/ssl/tidb/client-key.pem
    # For K8s: use *_file_env to reference env vars containing paths

  pool:
    max_open: 25
    max_idle: 5
    max_lifetime: 5m
  connection_timeout: 60s          # Wait for DB on startup (container-friendly)
  connection_retry_interval: 2s    # Initial retry interval (exponential backoff)

server:
  tls_mode: auto
  tls_auto_cert_dir: /tmp/tidb-graphql-tls
  port: 8080
  graphql_max_depth: 5
  graphql_max_complexity: 0
  graphql_max_rows: 0
  graphql_default_limit: 100
  schema_refresh_min_interval: 30s
  schema_refresh_max_interval: 5m
  graphiql_enabled: false

observability:
  service_name: tidb-graphql
  environment: production
  metrics_enabled: true
  tracing_enabled: false
  logging:
    level: info
    format: json
    exports_enabled: false

schema_filters:
  allow_tables: ["*"]
  deny_tables: []
  deny_mutation_tables: []
  scan_views_enabled: false
  allow_columns:
    "*": ["*"]
  deny_columns: {}
  deny_mutation_columns: {}

type_mappings:
  uuid_columns: {}
